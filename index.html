<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Discord Gateway æ¥ç¶š</title></head>
<body>
  <h1>ãƒ­ã‚°</h1>
  <pre id="log"></pre>
  <script>
    const log = msg => document.getElementById("log").textContent += msg + '\n';

    const socket = new WebSocket("wss://gateway.discord.gg/?v=9&encoding=json");

    let heartbeatInterval;

    socket.onmessage = event => {
      const data = JSON.parse(event.data);
      log(`[<=] ${JSON.stringify(data, null, 2)}`);

      switch (data.op) {
        case 10: // Hello
          const interval = data.d.heartbeat_interval;
          heartbeatInterval = setInterval(() => {
            socket.send(JSON.stringify({ op: 1, d: null }));
            log("[=>] Heartbeat sent");
          }, interval);

          // IDENTIFYï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³ã¯çµ¶å¯¾ã«æ™’ã•ãªã„ã“ã¨ï¼ï¼‰
          socket.send(JSON.stringify({
            op: 2,
            d: {
              token: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³ã“ã“ã«", // âš ï¸å±é™º âš ï¸
              properties: {
                "$os": "linux",
                "$browser": "chrome",
                "$device": "chrome"
              },
              capabilities: 61,
              presence: {
                status: "online",
                since: 0,
                activities: [],
                afk: false
              },
              compress: false
            }
          }));
          break;
        case 11:
          log("ğŸ’“ Heartbeat ACK");
          break;
        case 0:
          if (data.t === "READY") log("âœ… èªè¨¼æˆåŠŸï¼");
          if (data.t === "MESSAGE_CREATE") {
            log(`ğŸ“¨ ${data.d.author.username}: ${data.d.content}`);
          }
          break;
      }
    };
  </script>
</body>
</html>
